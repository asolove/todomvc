var F=F||{};F.internal_={};F.dom_={};F.xhr_={};F.doNotPropagate={};F.mkArray=function(a){return Array.prototype.slice.call(a)};F.internal_.Pulse=function(a,c){this.stamp=a;this.value=c};
F.internal_.PQ=function(){var a=this;a.val=[];this.insert=function(c){a.val.push(c);for(var b=a.val.length-1;0<b&&c.k<a.val[Math.floor((b-1)/2)].k;){var d=b,b=Math.floor((b-1)/2);a.val[d]=a.val[b];a.val[b]=c}};this.isEmpty=function(){return 0===a.val.length};this.pop=function(){if(1===a.val.length)return a.val.pop();var c=a.val.shift();a.val.unshift(a.val.pop());for(var b=0,d=a.val[0];;){var e=2*b+1<a.val.length?a.val[2*b+1].k:d.k+1,f=2*b+2<a.val.length?a.val[2*b+2].k:d.k+1;if(e>d.k&&f>d.k)break;
e<f?(a.val[b]=a.val[2*b+1],a.val[2*b+1]=d,b=2*b+1):(a.val[b]=a.val[2*b+2],a.val[2*b+2]=d,b=2*b+2)}return c}};F.internal_.lastRank=0;F.internal_.stamp=1;F.internal_.nextStamp=function(){return++F.internal_.stamp};
F.internal_.propagatePulse=function(a,c){var b=new F.internal_.PQ;for(b.insert({k:c.rank,n:c,v:a});!b.isEmpty();){var d=b.pop(),e=d.n.updater(new F.internal_.Pulse(d.v.stamp,d.v.value));if(e!=F.doNotPropagate)for(var f=0;f<d.n.sendsTo.length;f++)b.insert({k:d.n.sendsTo[f].rank,n:d.n.sendsTo[f],v:e})}};F.EventStream=function(a,c){this.updater=c;this.sendsTo=[];this.rank=++F.internal_.lastRank;for(var b=0;b<a.length;b++)a[b].attachListener(this)};
F.EventStream.prototype.attachListener=function(a){if(!(a instanceof F.EventStream))throw"attachListener: expected an F.EventStream";this.sendsTo.push(a);if(this.rank>a.rank)for(a=[a];a.length;){var c=a.splice(0,1)[0];c.rank=++F.internal_.lastRank;a=a.concat(c.sendsTo)}};
F.EventStream.prototype.removeListener=function(a){if(!(a instanceof F.EventStream))throw"removeListener: expected an F.EventStream";for(var c=!1,b=0;b<this.sendsTo.length&&!c;b++)this.sendsTo[b]===a&&(this.sendsTo.splice(b,1),c=!0);return c};F.internal_.internalE=function(a){return new F.EventStream(a||[],function(a){return a})};F.zeroE=function(){return new F.EventStream([],function(a){throw"zeroE : received a value; zeroE should not receive a value; the value was "+a.value;})};
F.oneE=function(a){var c=!1,b=new F.EventStream([],function(a){if(c)throw"oneE : received an extra value";c=!0;return a});window.setTimeout(function(){F.sendEvent(b,a)},0);return b};F.mergeE=function(a){if(0===arguments.length)return F.zeroE();var c=F.mkArray(arguments);return F.internal_.internalE(c)};F.EventStream.prototype.mergeE=function(){var a=F.mkArray(arguments);a.push(this);return F.internal_.internalE(a)};
F.EventStream.prototype.constantE=function(a){return new F.EventStream([this],function(c){c.value=a;return c})};F.Behavior=function(a,c,b){if(!(a instanceof F.EventStream))throw"F.Behavior: expected event as second arg";var d=this;this.last=c;this.underlyingRaw=a;this.underlying=new F.EventStream([a],b?function(a){d.last=b(a.value);a.value=d.last;return a}:function(a){d.last=a.value;return a})};F.Behavior.prototype.index=function(a){return this.liftB(function(c){return c[a]})};
F.receiverE=function(){var a=F.internal_.internalE();a.sendEvent=function(c){F.internal_.propagatePulse(new F.internal_.Pulse(F.internal_.nextStamp(),c),a)};return a};F.sendEvent=function(a,c){if(!(a instanceof F.EventStream))throw"sendEvent: expected Event as first arg";F.internal_.propagatePulse(new F.internal_.Pulse(F.internal_.nextStamp(),c),a)};
F.EventStream.prototype.bindE=function(a){var c=!1,b=new F.EventStream([],function(a){return a});b.name="bind outE";(new F.EventStream([this],function(d){c&&c.removeListener(b,!0);c=a(d.value);if(c instanceof F.EventStream)c.attachListener(b);else throw"bindE : expected F.EventStream";return F.doNotPropagate})).name="bind inE";return b};
F.EventStream.prototype.mapE=function(a){if(!(a instanceof Function))throw"mapE : expected a function as the first argument; received "+a;return new F.EventStream([this],function(c){c.value=a(c.value);return c})};F.EventStream.prototype.notE=function(){return this.mapE(function(a){return!a})};F.EventStream.prototype.filterE=function(a){if(!(a instanceof Function))throw"filterE : expected predicate; received "+a;return new F.EventStream([this],function(c){return a(c.value)?c:F.doNotPropagate})};
F.EventStream.prototype.onceE=function(){var a=!1;return this.filterE(function(){return!a?a=!0:!1})};F.EventStream.prototype.skipFirstE=function(){var a=!1;return this.filterE(function(){return!a?(a=!0,!1):!0})};F.EventStream.prototype.collectE=function(a,c){var b=a;return this.mapE(function(a){return b=a=c(a,b)})};F.EventStream.prototype.switchE=function(){return this.bindE(function(a){return a})};F.recE=function(a){var c=F.receiverE();a=a(c);a.mapE(function(a){c.sendEvent(a)});return a};
F.internal_.delayStaticE=function(a,c){var b=F.internal_.internalE();new F.EventStream([a],function(a){setTimeout(function(){F.sendEvent(b,a.value)},c);return F.doNotPropagate});return b};
F.EventStream.prototype.delayE=function(a){var c=this;if(a instanceof F.Behavior){var b=F.internal_.internalE(),d=c,e=F.internal_.delayStaticE(c,a.valueNow()),f=new F.EventStream([a.changes()],function(a){d.removeListener(e);d=c;e=F.internal_.delayStaticE(c,a.value);F.sendEvent(b,e);return F.doNotPropagate}),g=b.switchE();F.sendEvent(f,a.valueNow());return g}return F.internal_.delayStaticE(c,a)};
F.mapE=function(a){for(var c=F.mkArray(arguments),b=[],d=0,e=[],f=0;f<c.length;f++)c[f]instanceof F.EventStream?(e.push(c[f]),b.push(function(a){return function(b){return b[a]}}(d)),d++):b.push(function(a){return function(){return a}}(c[f]));var g=b.slice(1);if(0===e.length)return F.oneE(a.apply(null,c));if(1===e.length&&a instanceof Function)return e[0].mapE(function(){var b=arguments;return a.apply(null,g.map(function(a){return a(b)}))});if(1===e.length)return a.mapE(function(a){var b=arguments;
return a.apply(null,g.map(function(a){return a(b)}))});throw"unknown mapE case";};F.EventStream.prototype.snapshotE=function(a){return new F.EventStream([this],function(c){c.value=a.valueNow();return c})};F.EventStream.prototype.filterRepeatsE=function(a){var c=void 0===a?!1:!0,b=a;return this.filterE(function(a){return!c||b!==a?(c=!0,b=a,!0):!1})};
F.EventStream.prototype.calmE=function(a){a instanceof F.Behavior||(a=F.constantB(a));var c=F.internal_.internalE(),b=null;new F.EventStream([this],function(d){null!==b&&clearTimeout(b);b=setTimeout(function(){b=null;F.sendEvent(c,d.value)},a.valueNow());return F.doNotPropagate});return c};
F.EventStream.prototype.blindE=function(a){var c=F.EventStream,b=a instanceof F.Behavior?function(){return a.valueNow()}:function(){return a},d=(new Date).getTime()-b()-1;return new c([this],function(a){var c=(new Date).getTime();return c-d>b()?(d=c,a):F.doNotPropagate})};F.EventStream.prototype.startsWith=function(a){return new F.Behavior(this,a)};F.Behavior.prototype.valueNow=function(){return this.last};F.Behavior.prototype.changes=function(){return this.underlying};
F.Behavior.prototype.switchB=function(){var a=this.valueNow(),c=null,b=F.internal_.internalE(),d=new F.EventStream([this.changes()],function(a){if(!(a.value instanceof F.Behavior))throw"switchB: expected F.Behavior as value of F.Behavior of first argument";null!=c&&c.removeListener(b);c=a.value.changes();c.attachListener(b);F.sendEvent(b,a.value.valueNow());return F.doNotPropagate});a instanceof F.Behavior&&F.sendEvent(d,a);return b.startsWith(a instanceof F.Behavior?a.valueNow():a)};F.timerB=function(a){return F.timerE(a).startsWith((new Date).getTime())};
F.Behavior.prototype.delayB=function(a,c){a instanceof F.Behavior||(a=F.constantB(a));return this.changes().delayE(a).startsWith(3<arguments.length?c:this.valueNow())};F.Behavior.prototype.sendBehavior=function(a){F.sendEvent(this.underlyingRaw,a)};F.Behavior.prototype.ifB=function(a,c){a instanceof F.Behavior||(a=F.constantB(a));c instanceof F.Behavior||(c=F.constantB(c));return F.liftB(function(a,c,e){return a?c:e},this,a,c)};
F.condB=function(a){var c=F.mkArray(arguments);return F.liftB.apply({},[function(){for(var a=0;a<c.length;a++)if(arguments[a])return arguments[c.length+a]}].concat(c.map(function(a){return a[0]}).concat(c.map(function(a){return a[1]}))))};F.constantB=function(a){return new F.Behavior(F.internal_.internalE(),a)};
F.liftB=function(a,c){var b=Array.prototype.slice.call(arguments,1),d=F.mkArray(arguments).filter(function(a){return a instanceof F.Behavior}).map(function(a){return a.changes()}),e=function(a){return a instanceof F.Behavior?a.last:a},f=function(){return e(a).apply(null,b.map(e))};if(1===d.length)return new F.Behavior(d[0],f(),f);var g=-1,d=new F.EventStream(d,function(a){return a.stamp!=g?(g=a.stamp,a):F.doNotPropagate});return new F.Behavior(d,f(),f)};
F.Behavior.prototype.ap=function(a){var c=[this].concat(F.mkArray(arguments));return F.liftB.apply(null,c)};F.Behavior.prototype.liftB=function(a){return F.liftB(a,this)};F.Behavior.andB=function(a){return F.liftB.apply({},[function(){for(var a=0;a<arguments.length;a++)if(!arguments[a])return!1;return!0}].concat(F.mkArray(arguments)))};F.Behavior.orB=function(a){return F.liftB.apply({},[function(){for(var a=0;a<arguments.length;a++)if(arguments[a])return!0;return!1}].concat(F.mkArray(arguments)))};
F.Behavior.prototype.notB=function(){return this.liftB(function(a){return!a})};F.Behavior.prototype.blindB=function(a){return this.changes().blindE(a).startsWith(this.valueNow())};F.Behavior.prototype.calmB=function(a){return this.changes().calmE(a).startsWith(this.valueNow())};
F.dom_.swapDom=function(a,c){if(null===a||void 0===a)throw"swapDom: expected dom node or id, received: "+a;var b=F.dom_.getObj(a);if(!(0<b.nodeType))throw"swapDom expected a Dom node as first arg, received "+b;if(c){var d=F.dom_.getObj(c);if(!(0<d.nodeType))throw"swapDom: can only swap with a DOM object";try{if(null===b.parentNode)return d;d!=b&&b.parentNode.replaceChild(d,b)}catch(e){throw"swapDom error in replace call: withMeD: "+d+", replaceMe Parent: "+b+", "+e+", parent: "+b.parentNode;}}else b.parentNode.removeChild(b);
return b};F.dom_.getObj=function(a){if("object"===typeof a)return a;if("null"===typeof a||"undefined"===typeof a)throw"getObj: expects a Dom obj or Dom id as first arg";var c;if(document.getElementById)c=document.getElementById(a);else if(document.all)c=document.all[a];else if(document.layers)c=document.layers[a];else throw"getObj: flapjax: cannot access object";if(null===c||void 0===c)throw"getObj: no obj to get: "+a;return c};F.$=F.dom_.getObj;
F.dom_.getMostDom=function(a,c){var b=F.dom_.getObj(a);if(!(null===c||void 0===c||1>c.length))for(var d=0;d<c.length-1;d++)b=b[c[d]];return b};F.dom_.getDomVal=function(a,c){var b=F.dom_.getMostDom(a,c);c&&0<c.length&&(b=b[c[c.length-1]]);return b};F.timerE=function(a){a instanceof F.Behavior||(a=F.constantB(a));var c=F.receiverE(),b=function(){c.sendEvent((new Date).getTime())},d=null;a.liftB(function(a){d&&(clearInterval(d),d=null);"number"===typeof a&&0<a&&(d=setInterval(b,a))});return c};
F.dom_.deepEach=function(a,c){for(var b=0;b<a.length;b++)a[b]instanceof Array?F.dom_.deepEach(a[b],c):c(a[b])};F.dom_.mapWithKeys=function(a,c){for(var b in a)Object.prototype&&Object.prototype[b]===a[b]||c(b,a[b])};F.dom_.insertAfter=function(a,c,b){"undefined"!=typeof b&&b.nextSibling?a.insertBefore(c,b.nextSibling):a.appendChild(c)};
F.dom_.swapChildren=function(a,c,b){var d=Math.min(c.length,b.length),e;for(e=0;e<d;e++)a.replaceChild(b[e],c[e]);if(d<c.length)for(e=d;e<c.length;e++)a.removeChild(c[e]);else if(d<b.length)for(e=d;e<b.length;e++)F.dom_.insertAfter(a,b[e],b[e-1])};F.dom_.elementize=function(a){return 0<a.nodeType?a:document.createTextNode(a.toString())};F.dom_.staticEnstyle=function(a,c,b){b instanceof Object||(a[c]=b)};
F.dom_.dynamicEnstyle=function(a,c,b){b instanceof F.Behavior?(F.dom_.staticEnstyle(a,c,b.valueNow()),b.liftB(function(b){F.dom_.staticEnstyle(a,c,b)})):b instanceof Object?F.dom_.mapWithKeys(b,function(b,e){F.dom_.dynamicEnstyle(a[c],b,e)}):a[c]=b};
F.dom_.makeTagB=function(a){return function(){var c,b;"object"===typeof arguments[0]&&!(0<arguments[0].nodeType||arguments[0]instanceof F.Behavior||arguments[0]instanceof Array)?(c=arguments[0],b=Array.prototype.slice.call(arguments,1)):(c={},b=F.mkArray(arguments));var d=document.createElement(a);F.dom_.mapWithKeys(c,function(a,b){b instanceof F.Behavior?(d[a]=b.valueNow(),b.liftB(function(b){F.dom_.staticEnstyle(d,a,b)})):F.dom_.dynamicEnstyle(d,a,b)});F.dom_.deepEach(b,function(a){if(a instanceof
F.Behavior){var b=a.valueNow();b instanceof Array?(b=b.map(F.dom_.elementize),b.forEach(function(a){d.appendChild(a)}),a.liftB(function(a){a=a.map(F.dom_.elementize);F.dom_.swapChildren(d,b,a);b=a})):(b=F.dom_.elementize(b),d.appendChild(b),a.liftB(function(a){a=F.dom_.elementize(a);b.parentNode!=d?d.appendChild(a):d.replaceChild(a,b);b=a}))}else d.appendChild(F.dom_.elementize(a))});return d}};
"a b blockquote br button canvas div fieldset form font h1 h2 h3 h4 hr iframe input label legend li ol optgroup option p select span strong table tbody td textarea tfoot th thead tr tt ul".split(" ").forEach(function(a){window[a.toUpperCase()]=F.dom_.makeTagB(a)});F.elt=function(a,c,b){return F.dom_.makeTagB(a).apply(null,F.mkArray(arguments).slice(1))};F.text=function(a){a instanceof F.Behavior||(a=F.constantB(a));return a.changes().mapE(function(a){return document.createTextNode(a)}).startsWith(document.createTextNode(a.valueNow()))};
var DIV=F.dom_.makeTagB("div"),SPAN=F.dom_.makeTagB("span"),A=F.dom_.makeTagB("a"),TEXTAREA=F.dom_.makeTagB("TEXTAREA"),OPTION=F.dom_.makeTagB("OPTION"),INPUT=F.dom_.makeTagB("INPUT"),SELECT=F.dom_.makeTagB("SELECT"),IMG=F.dom_.makeTagB("IMG"),PRE=F.dom_.makeTagB("pre"),TEXT=function(a){return document.createTextNode(a)};
F.tagRec=function(a,c){if(!(a instanceof Array))throw"tagRec: expected array of event names as first arg";if(!(c instanceof Function))throw"tagRec: expected function as second arg";var b=a.length,d=[],e;for(e=0;e<b;e++)d.push(F.internal_.internalE());var f=c.apply(null,d);for(e=0;e<b;e++)F.extractEventE(f,a[e]).attachListener(d[e]);return f};
F.dom_.extractEventDynamicE=function(a,c,b){"undefined"===typeof b&&(b=!1);var d=F.receiverE(),e=function(a){d.sendEvent(a)},f=!1;a.liftB(function(a){f&&f.removeEventListener(c,e,b);(f=a)&&(a.addEventListener&&a.removeEventListener)&&a.addEventListener(c,e,b)});return d};F.dom_.extractEventStaticE=function(a,c,b){"undefined"===typeof b&&(b=!1);var d=F.receiverE();a.addEventListener(c,function(a){d.sendEvent(a)},b);return d};
F.extractEventE=function(a,c,b){return a instanceof F.Behavior?F.dom_.extractEventDynamicE(a,c,b):F.dom_.extractEventStaticE(a,c,b)};F.oneEvent=function(a,c){return F.recE(function(b){return F.extractEventE(b.constantE(!1).startsWith(a),c)})};F.extractEventsE=function(a,c){var b=Array.prototype.slice.call(arguments,1),b=(0===b.length?[]:b).map(function(b){return F.extractEventE(a,b)});return F.mergeE.apply(null,b)};
F.extractDomFieldOnEventE=function(a,c,b){if(!(a instanceof F.EventStream))throw"extractDomFieldOnEventE: expected Event as first arg";var d=Array.prototype.slice.call(arguments,2);return a.mapE(function(){return F.dom_.getDomVal(c,d)})};F.extractValueE=function(a){return F.extractValueB.apply(null,arguments).changes()};F.extractValueOnEventB=function(a,c){return F.dom_.extractValueStaticB(c,a)};
F.dom_.extractValueStaticB=function(a,c){var b;try{if(b=F.dom_.getObj(a),"string"===typeof a&&b.id!=a)throw"Make a radio group";}catch(d){b={type:"radio-group",name:a}}var e;switch(b.type){case "checkbox":e=F.extractDomFieldOnEventE(c?c:F.extractEventsE(b,"click","keyup","change"),b,"checked").filterRepeatsE(b.checked).startsWith(b.checked);break;case "select-one":e=function(){return-1<b.selectedIndex?b.options[b.selectedIndex].value?b.options[b.selectedIndex].value:b.options[b.selectedIndex].innerText:
void 0};e=(c?c:F.extractEventsE(b,"click","keyup","change")).mapE(e).filterRepeatsE().startsWith(e());break;case "select-multiple":e=function(){for(var a=[],c=0;c<b.options.length;c++)b.options[c].selected&&a.push(b.options[c].value?b.options[c].value:b.options[c].innerText);return a};e=(c?c:F.extractEventsE(b,"click","keyup","change")).mapE(e).startsWith(e());break;case "text":case "textarea":case "hidden":case "password":e=F.extractDomFieldOnEventE(c?c:F.extractEventsE(b,"click","keyup","change"),
b,"value").filterRepeatsE(b.value).startsWith(b.value);break;case "button":e=F.extractDomFieldOnEventE(c?c:F.extractEventsE(b,"click","keyup","change"),b,"value").startsWith(b.value);break;case "radio":case "radio-group":var f=F.mkArray(document.getElementsByTagName("input")).filter(function(a){return"radio"===a.type&&a.getAttribute("name")===b.name});e="radio"===b.type?function(){return b.checked}:function(){for(var a=0;a<f.length;a++)if(f[a].checked)return f[a].value};e=(c?c:F.mergeE.apply(null,
f.map(function(a){return F.extractEventsE(a,"click","keyup","change")}))).mapE(e).filterRepeatsE(e()).startsWith(e());break;default:throw'extractValueStaticB: unknown value type "'+b.type+'"';}return e};F.extractValueB=function(a){return a instanceof F.Behavior?a.liftB(function(a){return F.dom_.extractValueStaticB(a)}).switchB():F.dom_.extractValueStaticB(a)};F.$B=F.extractValueB;
F.dom_.deepStaticUpdate=function(a,c,b){c=c instanceof F.Behavior?c.valueNow():c;if("object"===typeof c)for(var d in c){if(!Object.prototype||!Object.prototype[d])F.dom_.deepStaticUpdate(b?a[b]:a,c[d],d)}else a[b]=c};
F.dom_.deepDynamicUpdate=function(a,c,b){var d=c instanceof F.Behavior?c.valueNow():c;if("object"===typeof d){if(c instanceof F.Behavior)throw"deepDynamicUpdate: dynamic collections not supported";for(var e in d)if(!Object.prototype||!Object.prototype[e])F.dom_.deepDynamicUpdate(b?a[b]:a,d[e],e)}else c instanceof F.Behavior&&new F.EventStream([c.changes()],function(c){b?a[b]=c.value:a=c.value;return F.doNotPropagate})};
F.insertValue=function(a,c){var b=Array.prototype.slice.call(arguments,2),d=F.dom_.getMostDom(c,b);F.dom_.deepStaticUpdate(d,a,b?b[b.length-1]:void 0)};F.insertValueE=function(a,c){if(!(a instanceof F.EventStream))throw"insertValueE: expected Event as first arg";var b=Array.prototype.slice.call(arguments,2),d=F.dom_.getMostDom(c,b);a.mapE(function(a){F.dom_.deepStaticUpdate(d,a,b?b[b.length-1]:void 0)})};
F.insertValueB=function(a,c,b){var d=Array.prototype.slice.call(arguments,2),e=F.dom_.getMostDom(c,d);F.dom_.deepStaticUpdate(e,a,d?d[d.length-1]:void 0);F.dom_.deepDynamicUpdate(e,a,d?d[d.length-1]:void 0)};F.insertDomE=function(a,c){if(!(a instanceof F.EventStream))throw"insertDomE: expected Event as first arg";var b=F.dom_.getObj(c);return a.mapE(function(a){"object"===typeof a&&1===a.nodeType||(a=SPAN({},a));F.dom_.swapDom(b,a);return b=a})};
F.dom_.insertDomInternal=function(a,c,b){switch(b){case void 0:case null:case "over":F.dom_.swapDom(a,c);break;case "before":a.parentNode.insertBefore(c,a);break;case "after":a.nextSibling?a.parentNode.insertBefore(c,a.nextSibling):a.parentNode.appendChild(c);break;case "leftMost":a.parentNode.firstChild?a.parentNode.insertBefore(c,a.parentNode.firstChild):a.parentNode.appendChild(c);break;case "rightMost":a.parentNode.appendChild(c);break;case "beginning":a.firstChild?a.insertBefore(c,a.firstChild):
a.appendChild(c);break;case "end":a.appendChild(c);break;default:throw"domInsert: unknown position: "+b;}};F.insertDom=function(a,c,b){F.dom_.insertDomInternal(F.dom_.getObj(c),"object"===typeof a&&0<a.nodeType?a:document.createTextNode(a),b)};
F.insertDomB=function(a,c,b){a instanceof F.Behavior||(a=F.constantB(a));a=a.liftB(function(a){if("object"===typeof a&&0<a.nodeType)return a;var b=document.createElement("span");b.appendChild(document.createTextNode(a));return b});var d=a.valueNow();if(!("object"===typeof d&&1===d.nodeType))throw"insertDomB: initial value conversion failed: "+d;F.dom_.insertDomInternal(null===c||void 0===c?F.dom_.getObj(d.getAttribute("id")):F.dom_.getObj(c),d,b);return F.insertDomE(a.changes(),d).startsWith(d)};
F.mouseE=function(a){return F.extractEventE(a,"mousemove").mapE(function(a){return a.pageX|a.pageY?{left:a.pageX,top:a.pageY}:a.clientX||a.clientY?{left:a.clientX+document.body.scrollLeft,top:a.clientY+document.body.scrollTop}:{left:0,top:0}})};F.mouseB=function(a){return F.mouseE(a).startsWith({left:0,top:0})};F.clicksE=function(a){return F.extractEventE(a,"click")};
F.xhr_.ajaxRequest=function(a,c,b,d,e){var f=new window.XMLHttpRequest;f.onload=function(){e(f)};f.open(a,c,d);"POST"===a&&f.setRequestHeader("Content-Type","application/x-www-form-urlencoded");f.send(b);return f};F.xhr_.encodeREST=function(a){var c="",b;for(b in a)"function"!==typeof a[b]&&(""!=c&&(c+="&"),c+=b+"="+encodeURIComponent(a[b]));return c};
F.EventStream.prototype.xhrWithBody_=function(a,c){var b=F.receiverE();this.mapE(function(d){var e=new window.XMLHttpRequest;e.onload=function(){4===e.readyState&&b.sendEvent({request:d,response:e.responseText,xhr:e})};e.open(a,c,!0);e.send(d)});return b};F.EventStream.prototype.POST=function(a){return this.xhrWithBody_("POST",a)};F.EventStream.prototype.index=function(a){return this.mapE(function(c){if("object"!==typeof c&&null!==c)throw"expected object";return c[a]})};
F.EventStream.prototype.JSONParse=function(){return this.mapE(function(a){return JSON.parse(a)})};F.EventStream.prototype.JSONStringify=function(){return this.mapE(function(a){return JSON.stringify(a)})};
F.getWebServiceObjectE=function(a){var c=F.receiverE();a.mapE(function(a){var d="",e="GET",f=a.url;if("get"===a.request)a.fields&&(f+="?"+F.xhr_.encodeREST(a.fields)),d="",e="GET";else if("post"===a.request)d=JSON.stringify(a.fields),e="POST";else if("rawPost"===a.request)d=a.body,e="POST";else if("rest"===a.request)d=F.xhr_.encodeREST(a.fields),e="POST";else throw"Invalid request type: "+a.request;var g=!1!==a.async;if("json"===a.response)F.xhr_.ajaxRequest(e,f,d,g,function(a){c.sendEvent(JSON.parse(a.responseText))});
else if("xml"===a.response)F.xhr_.ajaxRequest(e,f,d,g,function(a){c.sendEvent(a.responseXML)});else if("plain"===a.response||!a.response)F.xhr_.ajaxRequest(e,f,d,g,function(a){c.sendEvent(a.responseText)});else throw"Unknown response format: "+a.response;return F.doNotPropagate});return c};
